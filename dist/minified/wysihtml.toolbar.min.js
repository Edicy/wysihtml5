!function(a){"use strict";"function"==typeof define&&define.amd?define("wysihtml.toolbar",["wysihtml"],a):a("object"==typeof exports?require("wysihtml"):window.wysihtml)}(function(a){var b=function(){};b.extend=function(a,c){var d=b.prototype.extend;b._prototyping=!0;var e=new this;d.call(e,a),e.base=function(){},delete b._prototyping;var f=e.constructor,g=e.constructor=function(){if(!b._prototyping)if(this._constructing||this.constructor==g)this._constructing=!0,f.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||d).call(arguments[0],e)};return g.ancestor=this,g.extend=this.extend,g.forEach=this.forEach,g.implement=this.implement,g.prototype=e,g.toString=this.toString,g.valueOf=function(a){return"object"==a?g:f.valueOf()},d.call(g,c),"function"==typeof g.init&&g.init(),g},b.prototype={extend:function(a,c){if(arguments.length>1){var d=this[a];if(d&&"function"==typeof c&&(!d.valueOf||d.valueOf()!=c.valueOf())&&/\bbase\b/.test(c)){var e=c.valueOf();c=function(){var a=this.base||b.prototype.base;this.base=d;var c=e.apply(this,arguments);return this.base=a,c},c.valueOf=function(a){return"object"==a?c:e},c.toString=b.toString}this[a]=c}else if(a){var f=b.prototype.extend;b._prototyping||"function"==typeof this||(f=this.extend||f);for(var g={toSource:null},h=["constructor","toString","valueOf"],i=b._prototyping?0:1;j=h[i++];)a[j]!=g[j]&&f.call(this,j,a[j]);for(var j in a)g[j]||f.call(this,j,a[j])}return this}},b=b.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(a,b,c){for(var d in a)void 0===this.prototype[d]&&b.call(c,a[d],d,a)},implement:function(){for(var a=0;a<arguments.length;a++)"function"==typeof arguments[a]?arguments[a](this.prototype):this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}}),function(a){var b=a.dom,c="wysihtml-command-dialog-opened",d="input, select, textarea",e="[data-wysihtml-dialog-field]",f="data-wysihtml-dialog-field";a.toolbar.Dialog=a.lang.Dispatcher.extend({constructor:function(a,b){this.link=a,this.container=b},_observe:function(){if(!this._observed){var d=this,e=function(a){var b=d._serialize();d.fire("save",b),d.hide(),a.preventDefault(),a.stopPropagation()};b.observe(d.link,"click",function(){b.hasClass(d.link,c)&&setTimeout(function(){d.hide()},0)}),b.observe(this.container,"keydown",function(b){var c=b.keyCode;c===a.ENTER_KEY&&e(b),c===a.ESCAPE_KEY&&d.cancel()}),b.delegate(this.container,"[data-wysihtml-dialog-action=save]","click",e),b.delegate(this.container,"[data-wysihtml-dialog-action=cancel]","click",function(a){d.cancel(),a.preventDefault(),a.stopPropagation()}),this._observed=!0}},_serialize:function(){for(var a={},b=this.container.querySelectorAll(e),c=b.length,d=0;c>d;d++)a[b[d].getAttribute(f)]=b[d].value;return a},_interpolate:function(a){for(var b,c,d,g=document.querySelector(":focus"),h=this.container.querySelectorAll(e),i=h.length,j=0;i>j;j++)b=h[j],b!==g&&(a&&"hidden"===b.type||(c=b.getAttribute(f),d=this.elementToChange&&"boolean"!=typeof this.elementToChange?this.elementToChange.getAttribute(c)||"":b.defaultValue,b.value=d))},update:function(a){this.elementToChange=a?a:this.elementToChange,this._interpolate()},show:function(a){var e=this.container.querySelector(d);if(this._observe(),this.update(a),b.addClass(this.link,c),this.container.style.display="",this.isOpen=!0,this.fire("show"),e&&!a)try{e.focus()}catch(f){}},_hide:function(a){this.elementToChange=null,b.removeClass(this.link,c),this.container.style.display="none",this.isOpen=!1},hide:function(){this._hide(),this.fire("hide")},cancel:function(){this._hide(),this.fire("cancel")}})}(a),function(a){var b=(a.dom,"[data-wysihtml-dialog-field]"),c="data-wysihtml-dialog-field";a.toolbar.Dialog_bgColorStyle=a.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var a={},d=this.container.querySelectorAll(b),e=d.length,f=0;e>f;f++)a[d[f].getAttribute(c)]=d[f].value;return a},_interpolate:function(d){for(var e,f=document.querySelector(":focus"),g=this.container.querySelectorAll(b),h=g.length,i=0,j=this.elementToChange?a.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,k=j?j.getAttribute("style"):null,l=k?a.quirks.styleParser.parseColor(k,"background-color"):null;h>i;i++)e=g[i],e!==f&&(d&&"hidden"===e.type||"color"===e.getAttribute(c)&&(l?l[3]&&1!=l[3]?e.value="rgba("+l[0]+","+l[1]+","+l[2]+","+l[3]+");":e.value="rgb("+l[0]+","+l[1]+","+l[2]+");":e.value="rgb(0,0,0);"))}})}(a),function(a){a.toolbar.Dialog_createTable=a.toolbar.Dialog.extend({show:function(a){this.base(a)}})}(a),function(a){a.dom;a.toolbar.Dialog_fontSizeStyle=a.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){return{size:this.container.querySelector('[data-wysihtml-dialog-field="size"]').value}},_interpolate:function(b){var c=document.querySelector(":focus"),d=this.container.querySelector("[data-wysihtml-dialog-field='size']"),e=this.elementToChange?a.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,f=e?e.getAttribute("style"):null,g=f?a.quirks.styleParser.parseFontSize(f):null;d&&d!==c&&g&&!/^\s*$/.test(g)&&(d.value=g)}})}(a),function(a){var b="[data-wysihtml-dialog-field]",c="data-wysihtml-dialog-field";a.toolbar.Dialog_foreColorStyle=a.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var a={},d=this.container.querySelectorAll(b),e=d.length,f=0;e>f;f++)a[d[f].getAttribute(c)]=d[f].value;return a},_interpolate:function(d){for(var e,f,g=a.quirks.styleParser,h=document.querySelector(":focus"),i=this.container.querySelectorAll(b),j=i.length,k=0,l=this.elementToChange?a.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,m=l?l.getAttribute("style"):null,n=m?g.parseColor(m,"color"):null;j>k;k++)e=i[k],e!==h&&(d&&"hidden"===e.type||"color"===e.getAttribute(c)&&(f=(e.dataset.colormode||"rgb").toLowerCase(),f="hex"===f?"hash":f,n?e.value=g.unparseColor(n,f):e.value=g.unparseColor([0,0,0],f)))}})}(a),function(a){var b=a.dom,c={position:"relative"},d={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},e={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},f={"x-webkit-speech":"",speech:""};a.toolbar.Speech=function(g,h){var i=document.createElement("input");if(!a.browser.supportsSpeechApiOn(i))return void(h.style.display="none");var j=g.editor.textarea.element.getAttribute("lang");j&&(f.lang=j);var k=document.createElement("div");a.lang.object(d).merge({width:h.offsetWidth+"px",height:h.offsetHeight+"px"}),b.insert(i).into(k),b.insert(k).into(h),b.setStyles(e).on(i),b.setAttributes(f).on(i),b.setStyles(d).on(k),b.setStyles(c).on(h);var l="onwebkitspeechchange"in i?"webkitspeechchange":"speechchange";b.observe(i,l,function(){g.execCommand("insertText",i.value),i.value=""}),b.observe(i,"click",function(a){b.hasClass(h,"wysihtml-command-disabled")&&a.preventDefault(),a.stopPropagation()})}}(a),function(a){function c(b,c){var d=b.commands.state(c.name,c.value);return!c.dialog.multiselect&&a.lang.object(d).isArray()&&(d=1===d.length?d[0]:!0),d}var d="wysihtml-command-disabled",e="wysihtml-commands-disabled",f="wysihtml-command-active",g="wysihtml-action-active",h=a.dom;a.toolbar.Toolbar=b.extend({constructor:function(b,c,h){this.editor=b,this.container="string"==typeof c?document.getElementById(c):c,this.composer=b.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),h&&this.show(),null!=b.config.classNameCommandDisabled&&(d=b.config.classNameCommandDisabled),null!=b.config.classNameCommandsDisabled&&(e=b.config.classNameCommandsDisabled),null!=b.config.classNameCommandActive&&(f=b.config.classNameCommandActive),null!=b.config.classNameActionActive&&(g=b.config.classNameActionActive);for(var i=this.container.querySelectorAll("[data-wysihtml-command=insertSpeech]"),j=i.length,k=0;j>k;k++)new a.toolbar.Speech(this,i[k])},_getLinks:function(b){for(var c,d,e,f,g,h,i=this[b+"Links"]=a.lang.array(this.container.querySelectorAll("[data-wysihtml-"+b+"]")).get(),j=i.length,k=0,l=this[b+"Mapping"]={};j>k;k++)c=i[k],e=c.getAttribute("data-wysihtml-"+b),f=c.getAttribute("data-wysihtml-"+b+"-value"),h=c.getAttribute("data-wysihtml-"+b+"-blank-value"),d=this.container.querySelector("[data-wysihtml-"+b+"-group='"+e+"']"),g=this._getDialog(c,e),l[e+":"+f]={link:c,group:d,name:e,value:f,tracksBlankValue:h,dialog:g,state:!1}},_getDialog:function(b,c){var d,e,f=this,g=this.container.querySelector("[data-wysihtml-dialog='"+c+"']");return g&&(d=a.toolbar["Dialog_"+c]?new a.toolbar["Dialog_"+c](b,g):new a.toolbar.Dialog(b,g),d.on("show",function(){e=f.composer.selection.getBookmark(),f.editor.fire("show:dialog",{command:c,dialogContainer:g,commandLink:b})}),d.on("save",function(a){e&&f.composer.selection.setBookmark(e),f._execCommand(c,a),f.editor.fire("save:dialog",{command:c,dialogContainer:g,commandLink:b}),f._hideAllDialogs(),f._preventInstantFocus(),e=void 0}),d.on("cancel",function(){e&&f.composer.selection.setBookmark(e),f.editor.fire("cancel:dialog",{command:c,dialogContainer:g,commandLink:b}),e=void 0,f._preventInstantFocus()}),d.on("hide",function(){f.editor.fire("hide:dialog",{command:c,dialogContainer:g,commandLink:b}),e=void 0})),d},execCommand:function(a,b){this.commandsDisabled||this._execCommand(a,b)},_execCommand:function(a,b){this.editor.focus(!1),this.composer.commands.exec(a,b),this._updateLinkStates()},execAction:function(a){var b=this.editor;"change_view"===a&&(b.currentView===b.textarea||"source"===b.currentView?b.fire("change_view","composer"):b.fire("change_view","textarea")),"showSource"==a&&b.fire("showSource")},_observe:function(){for(var b=this,d=this.editor,f=this.container,g=this.commandLinks.concat(this.actionLinks),i=g.length,j=0;i>j;j++)"A"===g[j].nodeName?h.setAttributes({href:"javascript:;",unselectable:"on"}).on(g[j]):h.setAttributes({unselectable:"on"}).on(g[j]);h.delegate(f,"[data-wysihtml-command], [data-wysihtml-action]","mousedown",function(a){a.preventDefault()}),h.delegate(f,"[data-wysihtml-command]","click",function(a){var d,e=this,f=e.getAttribute("data-wysihtml-command"),g=e.getAttribute("data-wysihtml-command-value"),h=b.commandMapping[f+":"+g];g||!h.dialog?b.execCommand(f,g):(d=c(b.composer,h),h.dialog.show(d)),a.preventDefault()}),h.delegate(f,"[data-wysihtml-action]","click",function(a){var c=this.getAttribute("data-wysihtml-action");b.execAction(c),a.preventDefault()}),d.on("interaction:composer",function(a){b.preventFocus||b._updateLinkStates()}),this._ownerDocumentClick=function(c){a.dom.contains(b.container,c.target)||a.dom.contains(b.composer.element,c.target)||(b._updateLinkStates(),b._preventInstantFocus())},this.container.ownerDocument.addEventListener("click",this._ownerDocumentClick,!1),this.editor.on("destroy:composer",this.destroy.bind(this)),this.editor.config.handleTables&&(d.on("tableselect:composer",function(){b.container.querySelectorAll('[data-wysihtml-hiddentools="table"]')[0].style.display=""}),d.on("tableunselect:composer",function(){b.container.querySelectorAll('[data-wysihtml-hiddentools="table"]')[0].style.display="none"})),d.on("change_view",function(a){setTimeout(function(){b.commandsDisabled="composer"!==a,b._updateLinkStates(),b.commandsDisabled?h.addClass(f,e):h.removeClass(f,e)},0)})},destroy:function(){this.container.ownerDocument.removeEventListener("click",this._ownerDocumentClick,!1)},_hideAllDialogs:function(){var a=this.commandMapping;for(var b in a)a[b].dialog&&a[b].dialog.hide()},_preventInstantFocus:function(){this.preventFocus=!0,setTimeout(function(){this.preventFocus=!1}.bind(this),0)},_updateLinkStates:function(){var a,b,e,i,j,k=this.commandMapping,l=this.composer,m=this.actionMapping;for(a in k)i=k[a],this.commandsDisabled?(b=!1,h.removeClass(i.link,f),i.group&&h.removeClass(i.group,f),i.dialog&&i.dialog.hide()):(b=this.composer.commands.state(i.name,i.value),h.removeClass(i.link,d),i.group&&h.removeClass(i.group,d)),(i.state!==b||i.tracksBlankValue)&&(i.state=b,b?i.tracksBlankValue?h.removeClass(i.link,f):(h.addClass(i.link,f),i.group&&h.addClass(i.group,f),!i.dialog||"undefined"!=typeof i.value&&null!==i.value||(b&&"object"==typeof b?(b=c(l,i),i.state=b,j=i.dialog.container.dataset?i.dialog.container.dataset.showdialogonselection:!1,l.config.showToolbarDialogsOnSelection||j?i.dialog.show(b):i.dialog.update(b)):i.dialog.hide())):i.tracksBlankValue?h.addClass(i.link,f):(h.removeClass(i.link,f),i.group&&h.removeClass(i.group,f),i.dialog&&!i.value&&i.dialog.hide()));for(a in m)e=m[a],"change_view"===e.name&&(e.state=this.editor.currentView===this.editor.textarea||"source"===this.editor.currentView,e.state?h.addClass(e.link,g):h.removeClass(e.link,g))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}}),a.Editor.prototype.defaults.toolbar=void 0,a.Editor.prototype.defaults.showToolbarAfterInit=!0,a.Editor.prototype.defaults.showToolbarDialogsOnSelection=!0,a.extendEditor(function(b){b.config.toolbar&&(b.toolbar=new a.toolbar.Toolbar(b,b.config.toolbar,b.config.showToolbarAfterInit),b.on("destroy:composer",function(){b&&b.toolbar&&b.toolbar.destroy()}))})}(a)});
//# sourceMappingURL=wysihtml.toolbar.min.map